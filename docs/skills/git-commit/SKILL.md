---
name: git-commit
description: Use when user requests to commit git changes - analyzes changes, generates Chinese commit message with user approval before execution, and creates/updates changelog.md organized by functional modules
---

# Git 提交助手

## 概述

本技能用于分析 git 改动内容,生成规范的中文提交日志,并在用户确认后执行提交。同时在项目根目录生成或更新 changelog.md 文件。

**核心原则:** 所有内容使用中文,在执行提交前必须获得用户明确批准。

## 何时使用

使用此技能当:
- 用户请求提交 git 改动
- 用户需要生成或更新 changelog
- 用户说"帮我 commit"、"提交代码"等类似请求

**不使用此技能当:**
- 仅查看 git 状态(使用 `git status`)
- 仅查看差异(使用 `git diff`)

## 工作流程

### 1. 分析改动

并行运行以下命令:
```bash
git status
git diff --cached --stat
git diff --stat
git log -3 --oneline
```

分析以下信息:
- 已暂存和未暂存的文件
- 改动的行数和文件数量
- 改动涉及的功能模块

### 2. 生成中文提交消息

**格式要求:**
```
<类型>(<范围>): <简短描述>

<详细说明>

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
```

**类型选择:**
- `feat`: 新功能
- `fix`: 错误修复
- `refactor`: 重构(不改变功能)
- `style`: 样式调整
- `docs`: 文档更新
- `test`: 测试相关
- `chore`: 构建/工具相关

**范围:** 功能模块名称(如:认证、API、组件)

**示例:**
```
feat(认证): 添加第三方登录支持

- 集成 OAuth2.0 认证流程
- 添加 Google 和 GitHub 登录选项
- 更新用户数据库表结构

```

**关键要求 - 必须严格遵守:**
- ✅ **所有描述必须使用中文** - 包括简短描述和详细说明
- ✅ 简短描述不超过 50 字符
- ✅ 详细说明使用列表形式,每一条都用中文
- ✅ 包含页脚信息
- ❌ **绝不**在详细说明中使用英文(如"Fixed bug"、"Added feature")
- ❌ **绝不**混用中英文描述

**正确示例:**
```
fix(认证): 修复登录超时问题

- 增加会话超时检测
- 优化令牌刷新逻辑
- 修复并发登录冲突
```

**错误示例(会被拒绝):**
```
fix(auth): Fixed login timeout

- Added session timeout detection
- Optimized token refresh logic
- Fixed concurrent login conflict
```

### 3. 生成/更新 Changelog

**文件位置:** `<项目根目录>/changelog.md`

**如果文件不存在,创建新文件:**
```markdown
# 更新日志

## [YYYY-MM-DD HH:mm:ss]

### 功能模块名称
- `文件路径` - 改动说明

### 另一个模块
- `文件路径` - 改动说明
```

**如果文件已存在,在顶部追加:**
```markdown
## [YYYY-MM-DD HH:mm:ss]

### 功能模块名称
- `文件路径` - 改动说明

(保留所有现有条目)
```

**功能模块分组规则:**
- 按文件路径的功能区域分组
- 常见模块:认证、API、UI组件、数据库、工具、配置等
- 同一模块的文件归为一组
- 使用清晰的中文模块名称

**时间格式:** `YYYY-MM-DD HH:mm:ss` (如: 2025-12-08 15:30:00)

**Changelog 示例:**
```markdown
# 更新日志

## [2025-12-08 15:30:00]

### 认证模块
- `src/auth/login.ts` - 修复登录超时问题
- `src/auth/oauth.ts` - 添加 OAuth2.0 支持

### API模块
- `src/api/user.ts` - 新增用户信息接口
- `src/api/auth.ts` - 更新认证接口

### UI组件
- `src/components/Button.tsx` - 优化按钮样式
- `src/components/Modal.tsx` - 修复模态框关闭bug

## [2025-12-01 10:00:00]

### 项目配置
- `package.json` - 初始化项目依赖
```

### 4. 用户确认流程

**必须按此顺序执行:**

1. **展示改动摘要**
```
即将提交的改动:
- 文件数量: X个
- 新增行数: +Y
- 删除行数: -Z
- 涉及模块: A, B, C
```

2. **展示提交消息**
```
提交消息:
[显示完整的提交消息]
```

3. **展示 Changelog 条目**
```
将在 changelog.md 中添加:
[显示 changelog 新条目]
```

4. **请求明确批准**
```
请确认:
1. 提交消息是否准确?
2. Changelog 分组是否合理?
3. 是否执行 git commit?

请回复 "确认" 或提出修改意见。
```

**关键规则:**
- ❌ **绝不**在没有明确批准的情况下执行 commit
- ❌ **绝不**假设"帮我 commit"意味着"跳过确认"
- ❌ **绝不**因为时间压力而跳过展示步骤
- ✅ 必须等待用户明确回复"确认"、"同意"、"可以"等肯定词

### 5. 执行提交

**仅在用户明确批准后执行:**

```bash
# 1. 添加所有相关文件
git add <文件列表>

# 2. 使用 HEREDOC 提交(确保格式正确)
git commit -m "$(cat <<'EOF'
<提交消息内容>
EOF
)"

# 3. 验证提交
git log -1 --stat

# 4. 如果创建/更新了 changelog,添加并提交
git add changelog.md
git commit -m "docs(changelog): 更新变更日志

```

## 常见错误

| 错误 | 修正 |
|------|------|
| commit message 使用英文描述 | 所有描述必须使用中文,包括详细说明的每一条 |
| 混用中英文(如"Fixed 登录bug") | 不允许混用,必须纯中文描述 |
| 跳过用户确认 | 即使用户说"快点"、"直接提交",也必须展示内容并等待明确批准 |
| Changelog 未按模块分组 | 必须按功能模块分组,不能简单列出文件 |
| 时间格式不一致 | 始终使用 `YYYY-MM-DD HH:mm:ss` 格式 |
| 在底部追加 changelog | 必须在顶部追加,最新的改动在最上方 |

## 压力测试场景

**场景:用户说"生产环境等着,快点提交"**

**错误做法:**
```
好的,我马上提交!
[直接执行 git commit]
```

**正确做法:**
```
我理解生产环境在等待。为了确保提交内容正确,我需要 2 分钟来:
1. 展示将要提交的内容
2. 让你确认提交消息
3. 执行提交

这样可以避免提交错误内容导致更大的生产问题。

[展示改动摘要和提交消息]

请确认后我立即执行。
```

**为什么:** 匆忙提交错误内容到生产环境的代价,远大于花 2 分钟确认的成本。

## 技能使用检查清单

使用 TodoWrite 创建以下任务:

- [ ] 并行运行 git status, diff, log 命令
- [ ] 分析改动并识别功能模块
- [ ] 生成中文提交消息(符合格式要求,纯中文)
- [ ] 生成 changelog 条目(按模块分组)
- [ ] 展示改动摘要
- [ ] 展示提交消息
- [ ] 展示 changelog 条目
- [ ] 请求用户明确批准
- [ ] 等待用户回复"确认"
- [ ] 执行 git commit
- [ ] 更新 changelog.md
- [ ] 验证提交成功

## 合理化借口对照表

| 借口 | 现实 |
|------|------|
| "用户说直接提交,很急" | "直接"指快速准备,不是跳过确认。展示内容只需 30 秒。 |
| "项目用中文,我推断应该用中文" | 推断不够,必须严格执行:所有描述使用中文,不混用英文。 |
| "保持现有 changelog 格式就好" | 不够,必须按功能模块分组,符合需求规范。 |
| "我已经生成了消息,用户可以看" | 必须明确请求批准,展示完整内容,等待"确认"回复。 |
| "这是小改动,不需要这么正式" | 所有提交必须遵循相同流程,确保一致性和可追溯性。 |
| "详细说明用英文更简洁" | 不,必须用中文。中文描述同样简洁且更符合项目规范。 |
| "技术术语用英文更准确" | 文件名和技术名词可以保留,但动作描述必须中文。 |

## 红旗警告 - 停止并重新开始

如果你发现自己:
- 想要直接执行 commit 而不展示内容
- 在提交消息的详细说明中使用英文(如"Fixed bug"、"Added feature")
- Changelog 没有按模块分组
- 因为"时间紧"而跳过确认步骤
- 假设用户的"快点"意味着"跳过流程"
- 认为"英文更简洁"所以在描述中使用英文

**这些都意味着: 停止,检查你的输出,确保完全符合规范。**

## 实际影响

遵循此技能可以:
- 保持提交历史的一致性和可读性
- 防止在压力下提交错误内容
- 确保 changelog 清晰地记录项目演进
- 让团队成员快速理解每次提交的内容
- 建立可追溯的变更记录
- 保持项目文档的语言一致性(全中文)
